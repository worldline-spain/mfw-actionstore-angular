!function(){"use strict";function a(a,b,c){function d(a,c){function d(){return b.dispatch("$mfwActionFinished",c),(arguments||[]).length?arguments[0]:void 0}function e(){return b.dispatch("$mfwActionError",c),(arguments||[]).length?arguments[0]:void 0}var f=a.then(d,e);return f.$mfwId=c,f}function e(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}this.newAction=function(c){var f=e(),g=angular.isFunction(c)?c():c,h=d(g,f);return a(function(){b.dispatch("$mfwActionCreation",h)}),h}}function b(a){function b(a){return a.$mfwId}function c(a){return a?j(a,e):k(null,e)}function h(a){return a?j(a,f):k(null,f)}function i(a){return g+(a?a.id+".*":"*")}function j(a,b){return g+(a?a.id:"*")+"."+b}function k(a,b){return g+b+"."+(a?a.id:"*")}function l(a){return m.getAction(b(a))}var m={initialize:function(){var a={actions:{}};this.state=a},handlers:{$mfwActionCreation:"newAction",$mfwActionFinished:"actionFinished",$mfwActionError:"actionError"},newAction:function n(b){var n={id:b.$mfwId,promise:b,status:d};return this.state.actions[n.id]=n,a.debug("> New action",n.id),this.broadcastActionUpdate(n),n.id},actionFinished:function(b){a.debug("> Finished action",b),this.setActionStatus(b,e)},actionError:function(b,c){a.debug("> Error in action",b),this.setActionStatus(b,f,c)},getAction:function(b){return a.debug("> Get action",b),this.state.actions[b]},broadcastActionUpdate:function(b){var c=b.id,d=b.status;a.debug("> Broadcast action update",c,"with status",d),this.emit(j(b,d),b),this.emit(k(b,d),b)},setActionStatus:function(b,c,d){a.debug("> Update action",b,"with status",c,"and data",d),angular.extend(this.state.actions[b],{status:c,data:d}),this.broadcastActionUpdate(this.state.actions[b])},exports:{getAction:l,actionId:b,allEvents:function(a){return a?i(this.getAction(b(a))):i()},finishEvent:function(a){return a?c(this.getAction(b(a))):c()},errorEvent:function(a){return a?h(this.getAction(b(a))):h()}}};return m}var c=angular.module("mfw.business.actionstore",["flux"]),d="running",e="finished",f="error",g="mfw:Action.";c.service("$mfwActions",a),a.$inject=["$timeout","flux","$mfwActionStore"],c.store("$mfwActionStore",b),b.$inject=["$log"]}();
//# sourceMappingURL=mfw-business-action.store.min.js.map